<div class='container'>
  <div class='row'>
    <div class="col-sm-10 mx-auto">

      <div class="row justify-content-between">
        <div class="col-4"><h4>店舗一覧</4></div>
          <% if user_signed_in? %>
            <%= link_to "新規店舗登録", new_store_path %>
          <% end %>
      </div>

      <table class="table table-hover">
        <thead class="thead-light">
          <tr>
            <th scope="col">#</th>
            <th scope="col">店舗名</th>
            <th scope="col">住所</th>
            <th>

            </th>
            <th></th>
          </tr>
        </thead>

        <% if @genre == 'しょうゆ' %>

          <% @soy_sauce_ranks.each do |store| %>
            <% avg = store.store_comments.where(genre: 0).average(:rate) %>
              <% unless avg.nil? %>
                <tbody>
                  <tr>
                    <th>1</th>
                    <td>
                  <%= link_to store_path(store.id) do %>
                      <%= store.store_name %>
                      <% end %>
                   </td>
                    <td><%= store.address %></td>
                    <td><%= render 'star_average', { rate_name: "rate", store: store, score: avg.nil? ? 0 : avg.round(1) } %></td>
                  </tr>
                </tbody>
              <% end %>
          <% end %>

        <% elsif @genre == 'みそ' %>

          <% @miso_ranks.each do |store| %>
            <% avg = store.store_comments.where(genre: 1).average(:rate) %>

              <% unless avg.nil? %>
                <tbody>
                  <tr>
                    <th>1</th>
                    <td>
                  <%= link_to store_path(store.id) do %>
                      <%= store.store_name %>
                      <% end %>
                   </td>
                    <td><%= store.address %></td>
                    <td><%= render 'star_average', { rate_name: "rate", store: store, score: avg.nil? ? 0 : avg.round(1) } %></td>
                  </tr>
                </tbody>
              <% end %>
          <% end %>

        <% elsif @genre == 'とんこつ' %>

          <% @tonkotsu_ranks.each do |store| %>
            <% avg = store.store_comments.where(genre: 2).average(:rate) %>
              <% unless avg.nil? %>
                <tbody>
                  <tr>
                    <th>1</th>
                    <td>
                  <%= link_to store_path(store.id) do %>
                      <%= store.store_name %>
                      <% end %>
                   </td>
                    <td><%= store.address %></td>
                    <td><%= render 'star_average', { rate_name: "rate", store: store, score: avg.nil? ? 0 : avg.round(1) } %></td>
                  </tr>
                </tbody>
              <% end %>
          <% end %>

        <% elsif @genre == 'しお' %>
            <% avg = store.store_comments.where(genre: 3).average(:rate) %>
              <% unless avg.nil? %>
                <tbody>
                  <tr>
                    <th>1</th>
                    <td>
                  <%= link_to store_path(store.id) do %>
                      <%= store.store_name %>
                      <% end %>
                   </td>
                    <td><%= store.address %></td>
                    <td><%= render 'star_average', { rate_name: "rate", store: store, score: avg.nil? ? 0 : avg.round(1) } %></td>
                  </tr>
                </tbody>
              <% end %>
          <% end %>
      </table>

     </div>
   </div>
 </div>